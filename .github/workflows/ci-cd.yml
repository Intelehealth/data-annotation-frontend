# name: Frontend CI/CD

# on:
#   push:
#     branches: [main, develop]
#   pull_request:
#     branches: [main]

# env:
#   REGISTRY: gcr.io
#   IMAGE_NAME: indhic-ai/data-annotation-frontend
#   REGION: asia-south1
#   SERVICE_NAME: data-annotation-frontend

# jobs:
#   test:
#     runs-on: ubuntu-latest

#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v4

#       - name: Setup Node.js
#         uses: actions/setup-node@v4
#         with:
#           node-version: '18'
#           cache: 'npm'

#       - name: Install dependencies
#         run: npm ci

#       - name: Run tests
#         run: npm test

#       - name: Run linting
#         run: npm run lint

#       - name: Build application
#         run: npm run build

#   build-and-deploy:
#     needs: test
#     runs-on: ubuntu-latest
#     if: github.ref == 'refs/heads/main'

#     steps:
#       - name: Checkout code
#         uses: actions/checkout@v4

#       - name: Setup Google Cloud CLI
#         uses: google-github-actions/setup-gcloud@v2
#         with:
#           project_id: indhic-ai
#           service_account_key: ${{ secrets.GCP_SA_KEY }}
#           export_default_credentials: true

#       - name: Configure Docker for GCR
#         run: gcloud auth configure-docker

#       - name: Build Docker image with environment variables
#         run: |
#           docker build \
#             --build-arg NEXT_PUBLIC_API_URL="https://data-annotation-backend-124490363723.asia-south1.run.app" \
#             --build-arg NODE_ENV="production" \
#             -t $REGISTRY/$IMAGE_NAME:${{ github.sha }} .
#           docker build \
#             --build-arg NEXT_PUBLIC_API_URL="https://data-annotation-backend-124490363723.asia-south1.run.app" \
#             --build-arg NODE_ENV="production" \
#             -t $REGISTRY/$IMAGE_NAME:latest .

#       - name: Push Docker images
#         run: |
#           docker push $REGISTRY/$IMAGE_NAME:${{ github.sha }}
#           docker push $REGISTRY/$IMAGE_NAME:latest

#       - name: Deploy to Cloud Run
#         run: |
#           gcloud run deploy $SERVICE_NAME \
#             --image $REGISTRY/$IMAGE_NAME:latest \
#             --platform managed \
#             --region $REGION \
#             --allow-unauthenticated \
#             --port 3000 \
#             --memory 512Mi \
#             --cpu 1 \
#             --max-instances 3 \
#             --min-instances 0 \
#             --timeout 300 \
#             --concurrency 80

#       - name: Get deployment URL
#         run: |
#           echo "Frontend deployed to: $(gcloud run services describe $SERVICE_NAME --region $REGION --format 'value(status.url)')"
